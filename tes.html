<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sport Stream - Jadwal & Streaming</title>
  <style>
    /* Reset & base */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f4f4f9;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 10px;
    }
    header {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    select, input[type="search"] {
      padding: 8px 12px;
      font-size: 1em;
      border-radius: 5px;
      border: 1px solid #ccc;
      min-width: 180px;
      transition: border-color 0.3s;
    }
    select:focus, input[type="search"]:focus {
      border-color: #2980b9;
      outline: none;
    }
    button.toggle-theme {
      background-color: #2980b9;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 8px 15px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button.toggle-theme:hover {
      background-color: #1c5980;
    }

    /* Date section */
    .date-section {
      margin-bottom: 40px;
    }
    .date-title {
      font-size: 1.5em;
      margin-bottom: 15px;
      border-bottom: 2px solid #2980b9;
      padding-bottom: 5px;
      color: #2980b9;
    }

    /* Event card */
    .event-card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      padding: 15px;
      margin-bottom: 15px;
      position: relative;
      transition: box-shadow 0.3s;
    }
    .event-card.favorite {
      border: 2px solid #f39c12;
      box-shadow: 0 0 10px #f39c12;
    }
    .event-card:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    .event-header {
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 5px;
    }
    .event-details {
      margin-bottom: 10px;
      color: #555;
    }

    /* Channels */
    .channels a {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 5px;
      padding: 8px 12px;
      background-color: #2980b9;
      color: white;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s ease;
      cursor: pointer;
    }
    .channels a:hover {
      background-color: #1c5980;
    }

    /* Favorite button */
    .favorite-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      color: #ccc;
      transition: color 0.3s;
    }
    .favorite-btn.favorited {
      color: #f39c12;
    }
    .favorite-btn:hover {
      color: #e67e22;
    }

    /* Loading & error */
    .loading, .error {
      text-align: center;
      font-size: 1.2em;
      margin-top: 50px;
    }
    .error {
      color: red;
      font-weight: bold;
    }

    /* Modal popup */
    .modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      position: relative;
      background: #fff;
      border-radius: 8px;
      max-width: 90vw;
      max-height: 80vh;
      width: 800px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .modal-header {
      background: #2980b9;
      color: white;
      padding: 10px 15px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 1.5em;
      cursor: pointer;
      font-weight: bold;
    }
    .modal-body {
      flex-grow: 1;
      background: black;
    }
    .modal-body iframe {
      width: 100%;
      height: 450px;
      border: none;
    }

    /* Dark theme */
    body.dark {
      background: #121212;
      color: #ddd;
    }
    body.dark h1, body.dark .date-title {
      color: #66ccff;
    }
    body.dark .event-card {
      background: #1e1e1e;
      box-shadow: 0 2px 5px rgba(255,255,255,0.1);
      color: #ddd;
    }
    body.dark .event-card.favorite {
      border-color: #f39c12;
      box-shadow: 0 0 10px #f39c12;
    }
    body.dark .event-details {
      color: #bbb;
    }
    body.dark select, body.dark input[type="search"] {
      background: #333;
      border: 1px solid #555;
      color: #ddd;
    }
    body.dark select:focus, body.dark input[type="search"]:focus {
      border-color: #66ccff;
      outline: none;
    }
    body.dark .channels a {
      background-color: #66ccff;
      color: #121212;
    }
    body.dark .channels a:hover {
      background-color: #3399ff;
    }
    body.dark button.toggle-theme {
      background-color: #66ccff;
      color: #121212;
    }
    body.dark button.toggle-theme:hover {
      background-color: #3399ff;
    }
    body.dark .modal-header {
      background: #3399ff;
    }
  </style>
</head>
<body>
  <h1>Sport Stream - Jadwal & Streaming</h1>
  <header>
    <select id="sportFilter" aria-label="Filter jenis olahraga">
      <option value="all">Semua Jenis Olahraga</option>
    </select>
    <input type="search" id="searchInput" placeholder="Cari pertandingan..." aria-label="Cari pertandingan" />
    <button class="toggle-theme" id="themeToggle">Mode Gelap</button>
  </header>
  <div id="content">
    <div class="loading">Memuat data pertandingan...</div>
  </div>

  <!-- Modal Popup -->
  <div class="modal" id="streamModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle" tabindex="-1">
    <div class="modal-content">
      <div class="modal-header">
        <div id="modalTitle">Streaming</div>
        <button class="modal-close" id="modalClose" aria-label="Tutup streaming">&times;</button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- iframe akan dimasukkan di sini -->
      </div>
    </div>
  </div>

  <script>
    const contentDiv = document.getElementById('content');
    const sportFilter = document.getElementById('sportFilter');
    const searchInput = document.getElementById('searchInput');
    const themeToggle = document.getElementById('themeToggle');
    const streamModal = document.getElementById('streamModal');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');

    let allEvents = {};
    let filteredEvents = {};
    let favorites = new Set();
    let currentTheme = 'light';

    // Load favorites from localStorage
    function loadFavorites() {
      const fav = localStorage.getItem('sportStreamFavorites');
      if (fav) {
        try {
          favorites = new Set(JSON.parse(fav));
        } catch {
          favorites = new Set();
        }
      }
    }

    // Save favorites to localStorage
    function saveFavorites() {
      localStorage.setItem('sportStreamFavorites', JSON.stringify(Array.from(favorites)));
    }

    // Load theme from localStorage
    function loadTheme() {
      const theme = localStorage.getItem('sportStreamTheme');
      if (theme === 'dark') {
        document.body.classList.add('dark');
        themeToggle.textContent = 'Mode Terang';
        currentTheme = 'dark';
      } else {
        document.body.classList.remove('dark');
        themeToggle.textContent = 'Mode Gelap';
        currentTheme = 'light';
      }
    }

    // Toggle theme
    themeToggle.addEventListener('click', () => {
      if (currentTheme === 'light') {
        document.body.classList.add('dark');
        themeToggle.textContent = 'Mode Terang';
        currentTheme = 'dark';
      } else {
        document.body.classList.remove('dark');
        themeToggle.textContent = 'Mode Gelap';
        currentTheme = 'light';
      }
      localStorage.setItem('sportStreamTheme', currentTheme);
    });

    // Render events ke halaman
    function renderEvents(events) {
      contentDiv.innerHTML = '';
      if (!events || Object.keys(events).length === 0) {
        contentDiv.innerHTML = '<p>Tidak ada data pertandingan yang sesuai.</p>';
        return;
      }

      for (const date in events) {
        const dateSection = document.createElement('div');
        dateSection.className = 'date-section';

        const dateTitle = document.createElement('div');
        dateTitle.className = 'date-title';
        const dateObj = new Date(date);
        dateTitle.textContent = dateObj.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        dateSection.appendChild(dateTitle);

        events[date].forEach(event => {
          const eventCard = document.createElement('div');
          eventCard.className = 'event-card';
          if (favorites.has(event.unix_timestamp.toString())) {
            eventCard.classList.add('favorite');
          }

          const eventHeader = document.createElement('div');
          eventHeader.className = 'event-header';
          eventHeader.textContent = `${event.sport} - ${event.tournament}`;

          const eventDetails = document.createElement('div');
          eventDetails.className = 'event-details';
          const matchTime = new Date(event.unix_timestamp * 1000);
          eventDetails.innerHTML = `
            <strong>Match:</strong> ${event.match} <br />
            <strong>Waktu:</strong> ${matchTime.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}
          `;

          // Favorite button
          const favBtn = document.createElement('button');
          favBtn.className = 'favorite-btn';
          favBtn.innerHTML = favorites.has(event.unix_timestamp.toString()) ? '⭐' : '☆';
          if (favorites.has(event.unix_timestamp.toString())) {
            favBtn.classList.add('favorited');
          }
          favBtn.title = favorites.has(event.unix_timestamp.toString()) ? 'Hapus dari favorit' : 'Tambah ke favorit';
          favBtn.addEventListener('click', () => {
            const key = event.unix_timestamp.toString();
            if (favorites.has(key)) {
              favorites.delete(key);
              favBtn.innerHTML = '☆';
              favBtn.classList.remove('favorited');
              eventCard.classList.remove('favorite');
            } else {
              favorites.add(key);
              favBtn.innerHTML = '⭐';
              favBtn.classList.add('favorited');
              eventCard.classList.add('favorite');
            }
            saveFavorites();
          });

          // Channels
          const channelsDiv = document.createElement('div');
          channelsDiv.className = 'channels';
          event.channels.forEach(channelUrl => {
            const channelLink = document.createElement('a');
            channelLink.href = '#';
            channelLink.textContent = 'Tonton Streaming';
            channelLink.addEventListener('click', (e) => {
              e.preventDefault();
              openStreamModal(channelUrl, event.match);
            });
            channelsDiv.appendChild(channelLink);
          });

          eventCard.appendChild(eventHeader);
          eventCard.appendChild(eventDetails);
          eventCard.appendChild(favBtn);
          eventCard.appendChild(channelsDiv);

          dateSection.appendChild(eventCard);
        });

        contentDiv.appendChild(dateSection);
      }
    }

    // Filter dan cari data
    function filterAndSearch() {
      const selectedSport = sportFilter.value;
      const searchTerm = searchInput.value.toLowerCase();

      const filtered = {};

      for (const date in allEvents) {
        const filteredEventsForDate = allEvents[date].filter(event => {
          const matchSport = selectedSport === 'all' || event.sport === selectedSport;
          const matchSearch = event.match.toLowerCase().includes(searchTerm) || event.tournament.toLowerCase().includes(searchTerm);
          return matchSport && matchSearch;
        });
        if (filteredEventsForDate.length > 0) {
          filtered[date] = filteredEventsForDate;
        }
      }
      filteredEvents = filtered;
      renderEvents(filteredEvents);
    }

    // Isi dropdown filter jenis olahraga
    function populateSportFilter(events) {
      const sportsSet = new Set();
      for (const date in events) {
        events[date].forEach(event => {
          sportsSet.add(event.sport);
        });
      }
      const sports = Array.from(sportsSet).sort();
      sports.forEach(sport => {
        const option = document.createElement('option');
        option.value = sport;
        option.textContent = sport;
        sportFilter.appendChild(option);
      });
    }

    // Buka modal streaming
    function openStreamModal(url, title) {
      modalBody.innerHTML = `<iframe src="${url}" allowfullscreen allow="autoplay; fullscreen" title="Streaming ${title}"></iframe>`;
      document.getElementById('modalTitle').textContent = `Streaming: ${title}`;
      streamModal.classList.add('active');
      streamModal.focus();
    }

    // Tutup modal streaming
    function closeStreamModal() {
      streamModal.classList.remove('active');
      modalBody.innerHTML = '';
    }

    modalClose.addEventListener('click', closeStreamModal);
    streamModal.addEventListener('click', (e) => {
      if (e.target === streamModal) {
        closeStreamModal();
      }
    });

    // Ambil data dari API
    async function fetchSportEvents() {
      try {
        const response = await fetch('https://topembed.pw/api.php?format=json');
        if (!response.ok) throw new Error('Gagal mengambil data dari API');
        const data = await response.json();

        allEvents = data.events || {};
        if (Object.keys(allEvents).length === 0) {
          contentDiv.innerHTML = '<p>Tidak ada data pertandingan saat ini.</p>';
          return;
        }

        populateSportFilter(allEvents);
        filterAndSearch();
      } catch (error) {
        contentDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
      }
    }

    // Event listeners filter dan search
    sportFilter.addEventListener('change', filterAndSearch);
    searchInput.addEventListener('input', filterAndSearch);

    // Inisialisasi
    loadFavorites();
    loadTheme();
    fetchSportEvents();
  </script>
</body>
</html>
