<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BolabongTV Mobile</title>
<style>
  * { box-sizing: border-box; }
  html, body {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
  }
  header {
    background: #1f2937;
    padding: 15px 20px;
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
    color: #fbbf24;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .container {
    max-width: 768px;
    margin: auto;
    padding: 15px 20px;
  }
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
    position: relative;
  }
  select, input[type="date"], input[type="search"] {
    flex: 1 1 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    font-size: 1rem;
  }
  @media(min-width: 480px) {
    select, input[type="date"], input[type="search"] {
      flex: 1 1 auto;
    }
  }
  .match-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .match-item {
    background: #1e293b;
    margin-bottom: 12px;
    border-radius: 10px;
    padding: 12px 15px;
    display: flex;
    flex-direction: column;
    transition: background 0.3s ease;
  }
  .match-item:hover { background: #374151; }
  .match-header {
    display: flex;
    justify-content: space-between;
    font-weight: 600;
    font-size: 0.9rem;
    color: #fbbf24;
  }
  .teams {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    flex-wrap: wrap;
    gap: 5px;
  }
  .team {
    display: flex;
    align-items: center;
    gap: 8px;
    flex: 1 1 45%;
    min-width: 120px;
  }
  .team img {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: contain;
  }
  .team-name {
    font-weight: 600;
    font-size: 1rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .score {
    font-size: 1.2rem;
    font-weight: 700;
    color: #fbbf24;
    white-space: nowrap;
  }
  .status {
    margin-top: 8px;
    font-size: 0.85rem;
    text-align: right;
    white-space: nowrap;
  }
  .status.FT { color: #10b981; }
  .status.LIVE { color: #ef4444; }
  .status.NS { color: #60a5fa; }
  .loader {
    text-align: center;
    margin-top: 30px;
    color: #fbbf24;
  }
  .toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #1f2937;
    color: #fbbf24;
    padding: 12px 20px;
    border-radius: 10px;
    font-size: 0.95rem;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .toast.show {
    opacity: 1;
  }
  #playerModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.9);
    z-index: 99999;
    justify-content: center;
    align-items: center;
    padding: 10px;
  }
  #jwplayer-container {
    width: 100%;
    max-width: 960px;
    aspect-ratio: 16/9;
  }
  #playerModal select {
    position: absolute;
    top: 20px;
    left: 20px;
    padding: 6px;
    border-radius: 6px;
    z-index: 100001;
  }
  @media (max-width: 768px) {
    #jwplayer-container {
      max-width: 100%;
    }
    #playerModal select {
      top: 10px;
      left: 10px;
      font-size: 0.85rem;
    }
    #playerModal button {
      top: 10px;
      right: 10px;
      font-size: 0.85rem;
      padding: 6px 12px;
    }
  }
  @keyframes pulseLive {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.1); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
  }
  .play-icon span.live-animated {
    animation: pulseLive 1.5s infinite ease-in-out;
  }
  .play-icon {
    text-align: right;
    margin-top: 10px;
  }
  .play-icon span.live-animated {
    background: #ef4444;
    color: #fff;
    font-size: 0.75rem;
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: bold;
    display: inline-block;
    animation: pulseLive 1.5s infinite ease-in-out;
  }
  @media (max-width: 480px) {
    .play-icon span.live-animated {
      font-size: 0.7rem;
      padding: 3px 8px;
    }
  }
  .live-badge {
    position: absolute;
    top: 8px;
    right: 10px;
    background: #ef4444;
    color: #fff;
    padding: 4px 10px;
    font-size: 0.7rem;
    font-weight: bold;
    border-radius: 12px;
    animation: pulseLive 1.5s infinite ease-in-out;
    z-index: 10;
  }
  /* Responsive tweaks */
  @media (max-width: 768px) {
    .match-header {
      font-size: 0.85rem;
      flex-direction: column;
      align-items: flex-start;
    }
    .team-name {
      font-size: 0.9rem;
    }
    .score {
      font-size: 1rem;
    }
    .status {
      font-size: 0.75rem;
      text-align: left;
    }
    .filters {
      flex-direction: column;
    }
  }
  @media (max-width: 480px) {
    .team {
      flex-direction: column;
      align-items: flex-start;
    }
    .team img {
      width: 28px;
      height: 28px;
    }
    .filters select,
    .filters input[type="date"],
    .filters input[type="search"] {
      font-size: 0.9rem;
      padding: 8px;
    }
  }
</style>
<script src="https://cdn.jwplayer.com/libraries/IDzF9Zmk.js"></script>
</head>
<body>

<header>BolabongTV</header>

<div class="container">
  <div class="filters">
    <select id="leagueFilter" aria-label="Filter by League">
      <option value="">All Leagues</option>
    </select>
    <select id="statusFilter" aria-label="Filter by Match Status">
      <option value="">All Status</option>
      <option value="FT">Finished</option>
      <option value="NS">Not Started</option>
      <option value="LIVE">Live</option>
    </select>
    <input type="date" id="dateFilter" aria-label="Filter by Date" value="2025-06-02" />
    <input type="search" id="searchInput" placeholder="Search team or match..." aria-label="Search team or match" />
  </div>

  <ul class="match-list" id="matchList"></ul>
  
</div>

<script>
  const apiToken = 'AfyWw17488374000980ZzU5';
  const apiBase = 'https://api2.asiasport.com/match/getMatchListv4';

  const leagueFilter = document.getElementById('leagueFilter');
  const statusFilter = document.getElementById('statusFilter');
  const dateFilter = document.getElementById('dateFilter');
  const searchInput = document.getElementById('searchInput');
  const matchList = document.getElementById('matchList');
  const loader = document.getElementById('loader');

  

  function showToast(message) {
    let toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  let leagues = [], matches = [], leagueOptionSet = new Set();

  async function fetchMatches() {
            // matchList.innerHTML = ''; // removed for scroll preservation
    const leagueIds = leagueFilter.value;
    const status = statusFilter.value;
    const date = dateFilter.value;
    const liveOnly = status === 'LIVE' ? 'true' : 'false';

    const url = `${apiBase}?leagueIdList=${leagueIds}&matchDate=${date}&liveOnly=${liveOnly}&lang=en&timeZone=Asia%2FJakarta&token=${apiToken}`;

    try {
      const response = await fetch(url);
      const data = await response.json();
      if (data.errorCode === 0) {
        leagues = data.result.leagueMatchList;
        matches = [];
        leagues.forEach(league => {
          if (!leagueOptionSet.has(league.leagueId)) {
            const option = document.createElement('option');
            option.value = league.leagueId;
            option.textContent = league.leagueName;
            leagueFilter.appendChild(option);
            leagueOptionSet.add(league.leagueId);
          }
          league.matchList.forEach(match => {
            matches.push({...match, leagueName: league.leagueName});
          });
        });
        renderMatches();
      } else {
        showToast('Error loading matches: ' + (data.message || 'Unknown error'));
        matchList.innerHTML = '<li>Error loading matches.</li>';
      }
    } catch (err) {
      showToast('Network error: failed to load match data');
      matchList.innerHTML = '<li>Failed to fetch data.</li>';
    } finally {
                }
  }

  function renderMatches() {
    const status = statusFilter.value;
    const searchTerm = searchInput.value.toLowerCase();

    const filtered = matches.filter(match => {
      if (status && status !== 'LIVE' && match.matchStatus !== status) return false;
      if (searchTerm) {
        const teamNames = match.opponents.map(t => t.name.toLowerCase());
        const matchName = match.matchName.toLowerCase();
        if (!teamNames.some(name => name.includes(searchTerm)) && !matchName.includes(searchTerm)) return false;
      }
      return true;
    }).sort((a, b) => new Date(`${a.matchDate}T${a.matchTime}`) - new Date(`${b.matchDate}T${b.matchTime}`));

    if (!filtered.length) {
      matchList.innerHTML = '<li>No matches found.</li>';
      return;
    }

    matchList.innerHTML = '';
    const icons = { LIVE: 'ðŸ”´', FT: 'âœ…', NS: 'ðŸ•“' };

    function renderMatchItem(match) {
    const li = document.createElement('li');
    li.className = 'match-item';
    li.style.position = 'relative';
    const icon = icons[match.matchStatus] || '';
    const countdown = match.matchStatus === 'NS' ? (() => {
      const msDiff = new Date(match.matchDate + ' ' + match.matchTime) - new Date();
      const min = Math.floor(msDiff / 60000);
      const sec = Math.floor((msDiff % 60000) / 1000);
      return ` | <span style='color:#facc15;'>Kick-off in ${min}m${min < 5 ? ` ${sec}s` : ''}</span>`;
    })() : '';
    li.innerHTML = `
      <div class="match-header">${match.leagueName} - ${match.roundEn || ''}</div>
      <div class="teams">
        <div class="team">
          <img src="https://asset.asiasport.com/${match.opponents[0].logo}" alt="${match.opponents[0].name} logo" />
          <div class="team-name">${match.opponents[0].name}</div>
        </div>
        <div class="score">${match.opponents[0].score} - ${match.opponents[1].score}</div>
        <div class="team" style="justify-content: flex-end;">
          <div class="team-name">${match.opponents[1].name}</div>
          <img src="https://asset.asiasport.com/${match.opponents[1].logo}" alt="${match.opponents[1].name} logo" />
        </div>
      </div>
      <div class="status ${match.matchStatus}">${icon} ${match.matchStatus} | ${match.matchDate} ${match.matchTime}${countdown}</div>
      ${match.containLiveStream ? `<div class="live-badge">ðŸ”´ LIVE</div>` : ''}
    `;
    li.dataset.id = match.matchId;
    li.addEventListener('click', () => handlePlay(match));
    return li;
  }

  filtered.forEach(match => {
    const existing = document.querySelector(`[data-id="${match.matchId}"]`);
    if (existing) {
      existing.querySelector('.score').textContent = `${match.opponents[0].score} - ${match.opponents[1].score}`;
      existing.querySelector('.status').textContent = `${match.matchStatus} | ${match.matchDate} ${match.matchTime}`;
    } else {
      matchList.appendChild(renderMatchItem(match));
    }
  });
  }

  leagueFilter.addEventListener('change', renderMatches);
  statusFilter.addEventListener('change', () => {
    dateFilter.disabled = statusFilter.value === 'LIVE';
    fetchMatches();
  });
  dateFilter.addEventListener('change', fetchMatches);
  searchInput.addEventListener('input', renderMatches);
  fetchMatches();
  setInterval(fetchMatches, 1000);

  async function handlePlay(match) {
    try {
      const res = await fetch(`https://api2.asiasport.com/match/score?matchId=${match.matchId}&timeZone=Asia%2FJakarta&token=${apiToken}`);
      const data = await res.json();
      if (data?.result?.liveStreamUrl) {
        const streams = Array.isArray(data.result.liveStreamUrl) ? data.result.liveStreamUrl : [{ name: 'Default', url: data.result.liveStreamUrl }];
        const playlist = streams.map(s => ({ file: s.url, label: s.name }));

        jwplayer("jwplayer-container").setup({
          playlist,
          width: "100%",
          aspectratio: "16:9",
          autostart: true
        });

        // Show quality selector if multiple qualities
        if (streams.length > 1) {
          const selector = document.createElement('select');
          selector.style.position = 'absolute';
          selector.style.top = '20px';
          selector.style.left = '20px';
          selector.style.padding = '6px';
          selector.style.borderRadius = '6px';
          selector.style.zIndex = 100001;

          streams.forEach((s, i) => {
            const opt = document.createElement('option');
            opt.value = s.url;
            opt.textContent = s.name;
            if (i === 0) opt.selected = true;
            selector.appendChild(opt);
          });

          selector.onchange = e => {
            jwplayer().load([{ file: e.target.value }]);
            jwplayer().play(true);
          };

          document.getElementById('playerModal').appendChild(selector);
        }
        document.getElementById('playerModal').style.display = 'flex';
      } else {
        showToast("Live stream tidak tersedia untuk pertandingan ini.");
      }
    } catch {
      showToast("Gagal memuat live stream.");
    }
  }
</script>

<div id="playerModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.9); z-index:99999; justify-content:center; align-items:center;">
  <div id="jwplayer-container" style="width:90%; max-width:640px;"></div>
  <button onclick="jwplayer().remove(); document.getElementById('playerModal').style.display='none'" style="position:absolute; top:20px; right:20px; background:#fbbf24; color:#000; padding:10px; border:none; border-radius:6px; font-weight:bold;">Tutup</button>
</div>
</body>
</html>
